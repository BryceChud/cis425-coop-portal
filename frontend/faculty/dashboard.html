<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Faculty Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">

    <style>
        .dashboard-row {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: #043B72;
            padding: 20px;
            border-radius: 10px;
            width: 260px;
            color: white;
        }

        .card h3 {
            margin-top: 0;
            color: #FFCB05;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th, table td {
            border: 1px solid #0A2F56;
            padding: 12px;
            text-align: left;
            color: white;
        }

        table th {
            background-color: #043B72;
        }

        button {
            padding: 8px 16px;
            background: #FFCB05;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #e0b606;
        }
    </style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <img src="../assets/logo.png" class="header-logo">
    <h1 class="header-title">Faculty Dashboard</h1>

    <div>
        <button class="home-btn" onclick="goHome()">Home</button>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="container">

    <h2>Faculty Actions</h2>

    <div class="dashboard-row">

        <!-- Faculty Profile Card Only -->
        <div class="card">
            <h3>Faculty Profile</h3>
            <p>Update your name, email, and department.</p>
            <button onclick="window.location.href='profile.html'">Open</button>
        </div>

    </div>

    <!-- CO-OP STUDENTS TABLE -->
	<h2>Co-op Students</h2>

	<table>
		<thead>
			<tr>
				<th>Name</th>
				<th>Major</th>
				<th>Summary</th>
				<th>Grade</th>
				<th>Submit</th>
			</tr>
		</thead>

		<tbody id="coopBody">
			<!-- Filled dynamically -->
		</tbody>
	</table>


</div>

<script>
function logout() {
    window.location.href = "../index.html";
}

function goHome() {
    window.location.href = "dashboard.html";
}

// Read ?facultyId=123 from the URL; default to 1 if missing
function getFacultyIdFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get("facultyId") || "1";
}

// Show the student summary in a simple dialog
function showSummary(summaryText) {
    if (!summaryText) {
        alert("No summary has been entered yet.");
        return;
    }
    alert(summaryText);
}

// Call backend to update grade for a given CoopID
async function submitGrade(coopId, inputEl) {
    const grade = inputEl.value.trim();

    try {
        const res = await fetch(`/api/coop/${coopId}/grade`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ grade })
        });

        if (!res.ok) {
            const txt = await res.text();
            console.error("Failed to update grade:", txt);
            alert("Error updating grade.");
            return;
        }

        alert("Grade updated.");
    } catch (err) {
        console.error("Error updating grade", err);
        alert("Error updating grade.");
    }
}

// Render rows into the table
function renderCoopRows(rows) {
    const tbody = document.getElementById("coopBody");
    tbody.innerHTML = "";

    if (!rows || rows.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 5;
        td.textContent = "No co-op students found for your department.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
    }

    rows.forEach(row => {
        const tr = document.createElement("tr");

        const name = `${row.first || ""} ${row.last || ""}`.trim();
        const major = row.majorName || "N/A";

        // Name
        const nameTd = document.createElement("td");
        nameTd.textContent = name;
        tr.appendChild(nameTd);

        // Major
        const majorTd = document.createElement("td");
        majorTd.textContent = major;
        tr.appendChild(majorTd);

        // Summary (View button)
        const summaryTd = document.createElement("td");
        const summaryBtn = document.createElement("button");
        summaryBtn.textContent = "View";
        summaryBtn.addEventListener("click", () => showSummary(row.studentSummary));
        summaryTd.appendChild(summaryBtn);
        tr.appendChild(summaryTd);

        // Grade (input)
        const gradeTd = document.createElement("td");
        const gradeInput = document.createElement("input");
        gradeInput.type = "text";
        gradeInput.style.width = "60px";
        gradeInput.value = row.grade || "";
        gradeTd.appendChild(gradeInput);
        tr.appendChild(gradeTd);

        // Submit button
        const submitTd = document.createElement("td");
        const submitBtn = document.createElement("button");
        submitBtn.textContent = "Submit";
        submitBtn.addEventListener("click", () => submitGrade(row.coopId, gradeInput));
        submitTd.appendChild(submitBtn);
        tr.appendChild(submitTd);

        tbody.appendChild(tr);
    });
}

// Load co-op data when page is ready
async function loadCoopData() {
    const facultyId = getFacultyIdFromUrl();

    try {
        const res = await fetch(`/api/faculty/${facultyId}/coop`);
        if (!res.ok) {
            const txt = await res.text();
            console.error("Failed to load coop data:", txt);
            alert("Error loading co-op students.");
            return;
        }

        const data = await res.json();
        renderCoopRows(data);
    } catch (err) {
        console.error("Error loading coop data", err);
        alert("Error loading co-op students.");
    }
}

document.addEventListener("DOMContentLoaded", loadCoopData);
</script>


</body>
</html>
